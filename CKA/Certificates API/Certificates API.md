Я, как администратор кластера, в процессе его установки развернул также сервер CA и пачку сертификатов для различных компонентов. Затем запустил сервисы с использованием правильных сертификатов и сейчас запущено и работает. У меня, как у единственного администратора и пользователя кластера, есть свои собственные сертификат и ключ.

В команду пришел новый администратор. Ему нужен доступ в кластер. Я должен выдать ему пару ключ/сертификат для доступа в кластер. Новый админ создает свой собственный приватный ключ, генерирует CSR и посылает его мне. Т.к. только я являюсь администратором, то беру этот CSR и помещаю его на сервер CA, подписываю с помощью приватного ключа CA и корневого сертификата, тем самым генерируя новый сертификат и отправляю обратно новому администратору. Теперь у него есть собственная валидная пара ключ/сертификат, которую он может использовать для доступа к кластеру.

Сертификаты имеют срок годности, после определенного промежутка времени срок их действия заканчивается. Каждый раз, когда они "протухают", нам нужно по аналогичной процедуре генерировать новый CSR и подписывать его с помощью CA. Таким образом мы продолжаем ротацию файлов сертификатов.

Что такое сервер CA и где находится, когда речь идет о K8s? CA на самом деле представляет собой всего лишь пару файлов ключ/сертификат, которые мы сгенерировали. Любой получивший доступ к этой паре файлов сможет подписать любой сертификат для K8s окружения. Он сможет создать столько пользователей, сколько захочет, и с какими угодно привилегиями. Соответственно эти файлы должны быть защищены и храниться в безопасном окружении. Скажем, мы положили их на полностью безопасный сервер. Теперь этот сервер становится вашим сервером CA. Файлы ключа/сертификата безопасно хранятся на этом сервере и только на нем. Каждый раз, когда вы хотите подписать сертификат, то можете сделать это, только зайдя на этот сервер.

На данный момент мы имеем сертификаты, лежащие на самой master-ноде K8s. Соответственно master-нода также является нашим сервером CA.