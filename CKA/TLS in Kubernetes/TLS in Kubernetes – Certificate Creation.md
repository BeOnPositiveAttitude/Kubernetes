Для генерации сертификатов существуют различные инструменты, такие как *easyrsa*, *openssl*, *cfssl* и др. В данном уроке мы будем использовать openssl для генерации сертификатов.

Начнем с сертификатов CA.

- Сначала создаем приватный ключ: `openssl genrsa -out ca.key 2048`
- Затем создаем Certificate Signing Request: `openssl req -new -key ca.key -subj "/CN=KUBERNETES-CA" -out ca.csr`.

CSR - это как сертификат со всеми подробностями, но без подписи. В CSR мы указываем название компонента, для которого предназначен этот сертификат в поле `CN` (Common Name). Т.к. в данном случае мы создаем сертификат для Kubernetes CA, то назвали его соответствующим образом.

В конце мы подписываем сертификат: `openssl x509 -req -in ca.csr -signkey ca.key -out ca.crt`.

Т.к. сертификат предназначен для самого CA, то он самоподписан самим CA с использованием его собственного приватного ключа, сгенерированного на первом шаге. Далее мы будем использовать пару ключей CA для подписания и других сертификатов.

Теперь CA имеет приватный ключ и корневой сертификат. Отлично.

Теперь рассмотрим создание клиентских сертификатов. Начнем с пользователя admin.

- Сначала создаем приватный ключ: `openssl genrsa -out admin.key 2048`
- Затем создаем Certificate Signing Request: `openssl req -new -key admin.key -subj "/CN=kube-admin" -out admin.csr`.

Имя не обязательно должно быть `kube-admin`, это может быть что угодно. Но помните, что с этим именем будет аутентифицироваться клиент kubectl при использование kubectl-команд. Поэтому указанное имя вы будете видеть в логах аудита и в других местах. Соответственно указывайте в этом поле релевантное имя.

В конце генерируем подписанный сертификат, но в этот раз указываем ключ и сертификат CA:

`openssl x509 -req -in admin.csr -CA ca.crt -CAkey ca.key -out admin.crt`

Вы подписываете ваш сертификат с помощью пары ключей CA. Это создаст действительный сертификат в пределах кластера. Теперь с помощью сертификата `admin.crt` пользователь admin будет аутентифицироваться в K8s-кластере.

Процесс создания пары ключ/сертификат похож на процесс создания аккаунта для нового пользователя. Сертификат - проверенный ID пользователя, а ключ выступает в роли пароля. Только это намного безопаснее, чем простые имя пользователя и пароль.

Как вы будете различать пользователя admin и других пользователей? Аккаунт пользователя должен быть идентифицирован как пользователь admin, а не просто как еще один обычный пользователь. Делается это путем добавления в сертификат деталей о группе пользователя.