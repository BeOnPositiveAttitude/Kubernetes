На самом деле вам редко нужно конфигурировать pod-ы для взаимодействия друг с другом напрямую. Если вы хотите, чтобы один pod получил доступ к приложению, расположенному в другом pod-е, всегда нужно использовать Service.

Когда создается Service, он доступен для всех pod-ов в кластере, независимо от того на каких нодах они находятся. В том время как pod размещается на ноде, Service размещается в кластере. Он не связан с определенной нодой. Но важно помнить, что Service доступен только из кластера. Такой тип Service известен как *ClusterIP*.

Чтобы сделать приложение в pod-е доступным извне кластера, мы создаем другой тип Service - *NodePort*.

В данном уроке мы больше сфокусируемся на Services и меньше на pod-ах. Как Services получают IP-адреса и как они становятся доступны на всех нодах кластера? Как Service становится доступен для внешних пользователей через порт на каждой ноде?

Начнем с чистого листа. У нас есть кластер, состоящий из трех нод, пока еще нет pod-ов или Services. Мы уже знаем, что на каждой ноде запущен процесс kubelet, отвечающий за создание pod-ов. Каждый процесс kubelet на каждой ноде следит за изменениями в кластере через kube-apiserver. И каждый раз, когда должен быть создан новый pod, kubelet создает pod на нодах. Затем он вызывает CNI плагин для конфигурирования сети для этого pod-а.

Аналогично на каждой ноде запущен другой компонент - kube-proxy. Он тоже следит за изменениями в кластере через kube-apiserver и каждый раз, когда должен быть создан новый Service, вступает в действие. В отличие от pod-ов Services не создаются и не назначаются на каждую ноду. Services являются cluster wide концепцией. Они существуют на всех нодах кластера. Собственно говоря, они не существуют вовсе. Не существует сервера или сервиса, который действительно слушает на IP-адресе Service.