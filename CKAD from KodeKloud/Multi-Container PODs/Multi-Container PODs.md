Идея декомпозиции монолитного приложения на множество небольших, именуемых микросервисами, позволяет нам разрабатывать и деплоить небольшие и переиспользуемые куски кода

Такая архитектура позволяет нам легко масштабировать и изменять каждый из микросервисов в отличии от изменения монолитного приложения

Иногда требуется, чтобы два приложения работали вместе, например Web Server и Logging Service, то есть на один веб-сервер нужен один агент логирования, и чтобы они легко масштабировались также парой

Вот для чего нам нужен мультиконтейнерный pod, контейнеры которого имеют общий жизненный цикл, то есть создаются вместе и удаляются вместе, используют общую сеть - обращаются друг к другу как localhost, имеют доступ к общему volume

Существует несколько типов мультиконтейнерных pod-ов в K8s - Ambassador, Adapter и Sidecar

Хороший пример Sidecar - деплой Logging контейнера совместно с контейнером с веб-сервером для сбора логов и отправки их на лог-сервер

Следующий пример - Adapter, несколько приложений генерируют логи в разных форматах, и мы должны отправлять их на центральный лог-сервер

Лог-серверу будет тяжело обрабатывать логи в разных форматах

Для этого используют Adapter - перед отправкой логов на центральный лог-сервер, Adapter контейнер в каждом pod-е будет обрабатывать логи и приводить их к общему формату

Следующий пример - Ambassador, наше приложение взаимодействует с различными инстансами БД на разных стадиях разработки - Dev, Test, Prod

Соответственно мы должны каждый раз в коде приложения менять связность с различными БД в зависимости от стадии разработки

Мы можем вынести эту логику в отдельный контейнер в pod-е, чтобы наше приложение ссылалось на localhost БД, а Adapter контейнер уже будет проксировать наш запрос к нужной БД