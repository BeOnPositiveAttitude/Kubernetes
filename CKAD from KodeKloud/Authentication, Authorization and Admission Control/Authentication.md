Как правило существуют следующие группы пользователей:
- Администраторы - им нужен доступ к кластеру для выполнения административных задач
- Разработчики - тестируют и разворачивают приложения в кластере
- Конечные пользователи приложений, развернутых в кластере
- Боты/роботы - сторонние приложения, которым нужен доступ в кластер для различных интеграций

Безопасность конечных пользователей как правило реализована самими приложениями, поэтому мы не будем рассматривать этот вариант.

Оставшиеся варианты условно поделим на два типа - люди (админы и разработчики) и роботы (процессы, сервисы, приложения).

Сам K8s не управляет аккаунтами пользователей, он полагается на внешние источники - например, файл с данными пользователей, сертификаты или внешние поставщики идентификации (LDAP). Соответственно мы не можем создать пользователя командой
`kubectl create user user1` или просмотреть список пользователей `kubectl list users`.

В случае с Service Accounts K8s может управлять ими.

В данном уроке мы сосредоточимся на пользователях. Весь пользовательский доступ управляется API сервером, неважно используем ли мы утилиту kubectl или curl-запрос. Kube-apiserver аутентифицирует все пришедшие запросы перед обработкой. Какие механизмы для этого используются?

Это может быть файл со списком username/password, файл со списком username/token, сертификаты, сторонние протоколы аутентификации - LDAP, Kerberos и т.д.

Начнем с csv-файла в формате password,username,userid:

```
password123,user1,u0001
password123,user2,u0002
password123,user3,u0003
```

Далее нам нужно настроить API сервер с помощью указания опции `--basic-auth-file=user-details.csv`. Для этого необходимо, настроить службу kube-apiserver.service и указать там эту опцию, после чего перезапустить API сервер.

Либо если кластер был развернут с помощью утилиты kubeadm, тогда нужно отредактировать манифест-файл `vi /etc/kubernetes/manifests/kube-apiserver.yaml` и добавить эту опцию туда, после чего kubeadm автоматически перезапустит kube-apiserver.

В итоге мы сможем авторизоваться:

`curl -v -k https://master-node-ip:6443/api/v1/pods -u "user1:password123"`

Также мы можем добавить колонку group в наш csv-файл, чтобы назначать на пользователей соответствующую группу:

```
password123,user1,u0001,group1
password123,user2,u0002,group1
password123,user3,u0003,group2
password123,user4,u0004,group2
password123,user5,u0005,group2
```

Аналогично мы можем использовать файл со списком username/token. Вместо пароля мы указываем токен:

```
XrVfwqeWW298f0pE1vjIdRz9gdo53l,user10,u0010,group1
6hfSwhR6JZAhWMqLeyf1QVw0eUGOZq,user11,u0011,group1
OXfSXmmPhuF79aSLkQiMm8I3LjmA1y,user12,u0012,group2
8LY7OypstndNZmUyz2H1aUAFPcmsmN,user13,u0013,group2
```

Далее по аналогии нам нужно настроить API сервер с помощью указания опции `--token-auth-file=user-details.csv`.

В итоге мы сможем авторизоваться:

`curl -v -k https://master-node-ip:6443/api/v1/pods --header "Authorization: Bearer XrVfwqeWW298f0pE1vjIdRz9gdo53l"`

Однако это нерекомендуемые типы аутентификации, т.к. все данные пользователей хранятся в незашифрованном виде.