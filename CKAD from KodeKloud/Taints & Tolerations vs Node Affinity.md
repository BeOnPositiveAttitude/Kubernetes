Пример, у нас есть три ноды - Blue, Red, Green и три pod-а таких же цветов

Наша задача разместить синий pod на Blue ноде, красный на Red, зеленый на Green

Плюс мы делим кластер с другими командами и у нас есть еще две ноды и различные pod-ы, соответственно мы не хотим, чтобы сторонние pod-ы размещались на наши "цветные" ноды, и чтобы наши "цветные" поды размещались на сторонних нодах

Для начала попробуем решить эту задачу с помощью механизма Taints & Tolerations

Мы наносим на каждую цветную ноду соответствующий Taint - Blue, Red, Green и на каждый "цветной" pod соответствующий Toleration

Теперь мы уверены, что наши ноды примут на себя только pod-ы с соответствующим Toleration

Однако любой из наших "цветных" pod-ов также может быть размещен на любую стороннюю ноду кластера, которая вообще не имеет никаких Taints, т.к. механизм Taints & Tolerations не означает, что pod гарантированно будет размещен на определенной ноде

Это не желаемый нами результат

Тогда попробуем решить задачу с помощью Node Affinity

Мы маркируем каждую "цветную" ноду соответствующим Label - Blue, Red, Green, и на каждом "цветном" pod-е настраиваем nodeSelector, таким образом наши "цветные" pod-ы успешно размещаются на "цветных" нодах

Однако в этом случае любой сторонний pod также может быть размещен на наших "цветных" нодах, и этот вариант нас тоже не устраивает

В итоге мы должны использовать комбинацию Taints & Tolerations и Node Affinity

Мы наносим на каждую цветную ноду соответствующий Taint - Blue, Red, Green и на каждый "цветной" pod соответствующий Toleration, а также маркируем каждую "цветную" ноду соответствующим Label - Blue, Red, Green, и на каждом "цветном" pod-е настраиваем nodeSelector, чтобы предотвратить размещение "цветных" pod-ов на сторонних нодах; в тоже время сторонние pod-ы не смогут быть помещены на наши "цветные" ноды из-за нанесенных на ноды Taints
