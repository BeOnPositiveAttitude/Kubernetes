Как мы знаем, не существует строгой изоляции между контейнерами и Docker-хостом (в отличие от ВМ, где сохраняется полная изоляция).

Частично изоляция достигается за счет namespace-ов.

Хост, на котором установлен Docker имеет свой namespace, а контейнеры на этом хосте имеют свои namespace-ы.

Фактически процессы запущенные в контейнере - это процессы запущенные на Docker-хосте, но в своих собственных namespace-ах.

Таким образом контейнер может видеть только свои собственные процессы и не видит процессы в других namespace-ах.

То есть в контейнере это может быть процесс `sleep` с PID=1, а Docker-хост в свою очередь видит процессы в своем namespace-е и в дочерних namespace-ах и для Docker-хоста это всего лишь еще один процесс в системе, например с PID=3816.

---

Docker-хост имеет свой набор юзеров, включая `root`.

По умолчанию Docker запускает процессы в контейнерах под пользователем `root`.

Это можно увидеть командой `ps aux` запущенной в контейнере и на Docker-хосте, описанный выше процесс `sleep` и там и там отобразится как запущенный под пользователем `root`.

Если мы не хотим, чтобы процесс в контейнере запускался под пользователем `root`, это поведение можно изменить:

`docker run --user=1000 ubuntu sleep 3600`

Другой способ - переопределить юзера сразу на этапе создания Docker-image:

```
FROM ubuntu
USER 1000
```
`docker build -t my-ubuntu-image .`

Теперь мы можем запустить наш кастомный образ без указания юзера:

`docker run my-ubuntu-image sleep 3600`

Когда мы запускаем контейнер под пользователем `root`, это тот же самый `root` что и на Docker-хосте?

Может ли пользователь `root` в контейнере выполнить что-либо, что и пользователь `root` на Docker-хосте?

Docker имеет security features, которые ограничивают возможности пользователя `root` в контейнере.

Пользователь `root` в контейнере - это не одно и то же, что пользователь `root` на Docker-хосте.

Docker использует Linux capabilities для осуществления функционала security features.

Список возможностей, которые может использовать юзер root: `/usr/include/linux/capability.h`.

С помощью этого файла вы можете управлять набором capabilities (возможностей) для юзера `root`.

Docker запускает контейнер с ограниченным набором capabilities, чтобы процесс контейнера не смог например перезагрузить Docker-хост.

Добавить capabilities: `docker run --cap-add MAC_ADMIN ubuntu`.

Убрать capabilities: `docker run --cap-drop KILL ubuntu`.

Запустить с полным набором привилегий: `docker run --privileged ubuntu`.
