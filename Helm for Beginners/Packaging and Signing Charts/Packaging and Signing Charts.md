На текущий момент у нас нет уже созданных Chart, которыми можно поделиться со всем миром. Сначала мы упаковываем Chart, затем загружаем в репозиторий, чтобы другие пользователи могли его скачать и установить.

Чтобы упаковать Chart нужно использовать команду: `helm package ./nginx-chart`. На выходе мы получим файл `nginx-chart-0.1.0.tgz`. Версия 0.1.0 - это версия Chart, берется из файла Chart.yaml, .tgz означает .tar-архив, сжатый с помощью gzip.

Осталось загрузить Chart в репозиторий. Как правило не рекомендуется загружать полученный файл как есть. Стоит позаботиться о подписании полученного файла, чтобы другие пользователи были уверены в легитимности нашего Chart. Чтобы мы не загружали из интернета, нельзя быть на 100% уверенным, что это именно файл, загруженный разработчиком, т.к. сервер может быть взломан и файлы подменены вредоносным контентом. Один из способов сделать загрузку более безопасной - криптографически подписывать файлы и пакеты. Например мы написали Chart и уверены, что его содержимое безопасно для использования. Но как другие пользователи загружающие наш Chart могут быть уверены, что это точно Chart, а не какой-либо вредоносный файл, загруженный хакером?

Helm предоставляет нам необходимые инструменты - он использует приватный ключ, доступ к которому есть только у нас, разработчиков Chart. С помощью этого ключа он создает цифровую подпись и добавляет ее к так называемому provenance-файлу. Пользователь загружает Chart и provenance-файл и смотрит на подпись. Затем с помощью публичного ключа, который, как они знают, принадлежит нам, пользователь может верифицировать, что Chart подписан корректно. А если подпись верна, значит можно быть уверенным, что Chart подписан разработчиком.

Мы можем сгенерировать приватный и публичный ключи с помощью GPG (GNU Privacy Guard): `gpg --quick-generate-key "John Smith"`.

Вывод команды:

```
gpg: /Users/19919937/.gnupg/trustdb.gpg: создана таблица доверия
gpg: создан каталог '/Users/19919937/.gnupg/openpgp-revocs.d'
gpg: сертификат отзыва записан в '/Users/19919937/.gnupg/openpgp-revocs.d/D67844B8AC936D60C1FA227ABDA4EA5463887EBA.rev'.
открытый и секретный ключи созданы и подписаны.

pub   ed25519 2023-02-06 [SC] [   годен до: 2025-02-05]
      D67844B8AC936D60C1FA227ABDA4EA5463887EBA              #уникальный идентификатор публичного ключа
uid                      John Smith
sub   cv25519 2023-02-06 [E]
```

Далее публичный ключ может быть загружен в Open PGP Key Server, например keyserver.ubuntu.com, пользователи смогут скачать его, используя уникальный идентификатор и верифицировать подпись.

В production environment нужно генерировать ключи командой: `gpg --full-generate-key "John Smith"`. При этом способе можно сконфигурировать больше опций.

Большинство дистрибутивов Linux сейчас используют GnuPG v2, который хранит ключи в формате отличном от предыдущих версий. Для подписывания Charts Helm использует более старый формат. Мы можем сконвертировать новый keyring формат в старый формат командой: `gpg --export-secret-keys >~/.gnupg/secring.gpg`.

Далее мы упаковываем Chart, но уже с опцией `--sign`: `helm package --sign --key 'John Smith' --keyring ~/.gnupg/secring.gpg ./nginx-chart`. Не сработало.

Если забыли какие-то детали о ключах: `gpg --list-keys`.

После упаковывания Chart с одновременным подписыванием кроме архива .tgz создастся еще один файл - nginx-chart-0.1.0.tgz.prov (provenance-файл). Его содержимое покажет какой hash должен иметь .tgz-архив. Команда `sha256sum nginx-chart-0.1.0.tgz` также покажет hash. Если мы изменим хотя бы один байт в архиве, hash изменится кардинально. Provenance-файл, тоже скачивается из интернета и возможно хакер сгенерировал вредоносный .tgz-архив и затем отредактировал provenance, а также переключил hash оригинального файла на hash поддельного файла.

Начало секции PGP Signature - место где происходит настоящая магия. Это подпись для provenance-файла говорит что-то вроде - "Я Джон Смит, владелец публичного ключа, я подписал содержимое этого файла и вы можете быть уверены, что hash, который вы видите, корректный, если можете верифицировать подпись с помощью моего публичного ключа". Продолжение следует...