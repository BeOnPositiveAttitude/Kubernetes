Способ, с помощью которого можно контролировать и понимать поведение сервисов, состоит в мониторинге отдельных запросов в процессе их прохождения через Mesh, и называется этот способ - распределенная трассировка (distributed tracing).

Зависимости сервисов и источники задержек в Mesh-е могут наблюдаться через трассировку.

Istio включает распределенную трассировку через envoy proxies и поддерживает такие решения как Zipkin, Jaeger, Lightstep и Datadog.

Для начала рассмотрим как работает трассировка в Jaeger при штатной работе нашего приложения.

Чтобы открыть Jaeger Dashboard используем команду: `istioctl dashboard jaeger`. Слева на Dashboard можно управлять различными критериями поиска.

Выберем istio-ingressgateway и нажмем "Find Traces". Видим трассировки на графе. Изменим количество на 50 вместо стандартных 20.

Нагрузка, которую мы создаем на наше приложение с помощью `curl` цикла, является действительно высокой.

Можно отсортировать по трассировки по различным критериям. "Провалимся" в одну из них, чтобы посмотреть более детально. Каждая строка отражает span.

Span - логическая единица работы. Каждый span занимает некоторое количество времени. И мы можем раскрыть каждый из них. Тэги могут использоваться для фильтрации трассировок.

Вернемся на главную страницу и выберем сервис Reviews из списка. Теперь добавим задержку в сервис Details.

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: details
spec:
  hosts:
    - details
  http:
  - fault:
      delay:
        percentage:
          value: 70.0
        fixedDelay: 7s
    route:
    - destination:
        host: details
        subset: v1
```

Когда мы добавляем задержку в сервис Details, то сервис Product Page будет ждать три секунды и отдавать ошибку `Sorry, product details are currently unavailable for this book`. Проверим Dashboard Kiali.

Вернемся в Jaeger и посмотрим на ошибку. Выберем из списка сервис Product Page, количество вернем в значение 20. Видим, что есть проблема, но не во всех трассировках, т.к. мы добавили только 70% задержек. Раскроем одну из трассировок с пометкой "1 Error". Видим, что сервис Product Page получает ошибку в процессе ожидания ответа от сервиса Details. Ожидание занимает три секунды, т.к. это значение "захардкожено" в конфигурации сервиса Product Page.

Убедитесь как правильно сконфигурировать Jaeger для вашего окружения перед установкой.