Для чего может понадобится Kyverno?

Изначально сам K8s не выполняет каких-либо validation checks над манифестами, кроме проверки корректности синтаксиса.

Мы же к примеру хотим, чтобы у каждого манифеста проставлялся label с названием команды (team), которая написала этот манифест. Кроме того мы хотим запретить использование тэга `latest`.

Плюс еще ряд ограничений:

<img src="image.png" width="400" height="250"><br>

Kyverno - это policy enforcement engine, который позволяет нам создавать различные правила/политики, которые обеспечивают соблюдение требуемых ограничений на конфигурацию объектов в кластере.

Если объект не удовлетворяет заданным политикам, то его создание будет отклонено.

Для начала вспомним какой путь проходит запрос после ввода команды `kubectl apply -f`.

<img src="image-1.png" width="1000" height="300"><br>

Больше всего в этой цепочке нас интересует Admission Controller, который способен выполнять как валидацию, так и модификацию запросов. Функциональность Admission Controller расширяется различными плагинами.

Если у нас есть некое специфическое требование, под которое пока не существует нужного плагина, то мы можем задействовать функционал ValidatingAdmissionWebhook и MutatingAdmissionWebhook, которые в свою очередь могут вызывать какое-либо third-party решение с определенной логикой.

Как изменится схема прохождения запроса:

<img src="image-2.png" width="1000" height="300"><br>

Теперь когда Admission Controller получает запрос, то на этапах Mutating Admission (изменение исходного запроса) и Validating Admission (проверка запроса) он будет обращаться к Kyverno с помощью настроенного webkook.